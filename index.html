<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Typegrind : type preserving heap profiler for C++">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Typegrind</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/typegrind">View on GitHub</a>

          <h1 id="project_title">Typegrind</h1>
          <h2 id="project_tagline">type preserving heap profiler for C++</h2>

        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <p>Typegrind is a type preserving heap profiler for C++ - it collects memory allocation information with type information.</p>

<h2>
<a id="components" class="anchor" href="#components" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Components</h2>

<p>Typegrind consists of two main components:</p>

<ul>
<li>Instrumentator, which is a source-to-source compiler, decorating the C++ source with code required for the logger.</li>
<li>Loggers, which do something useful with the information provided by the instrumented code (e.g. write it to a logfile).</li>
</ul>

<h2>
<a id="building" class="anchor" href="#building" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Building</h2>

<p>Typegrind can be built as part of the clang build process. This repository makes it easier using the <a href="https://source.android.com/source/using-repo.html">repo tool</a>.</p>

<p>To checkout and build everything execute:</p>

<div class="highlight highlight-source-shell"><pre>repo init -u <span class="pl-s"><span class="pl-pds">"</span>https://github.com/typegrind/typegrind.git<span class="pl-pds">"</span></span>
repo sync
<span class="pl-c1">cd</span> build
cmake ../
cmake --build <span class="pl-c1">.</span></pre></div>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Usage</h2>

<p>TODO TODO TODO</p>

<h2>
<a id="example" class="anchor" href="#example" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Example</h2>

<p>The original source code:</p>

<div class="highlight highlight-source-c++"><pre>#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&lt;</span>typegrind/log_to_cout.hpp<span class="pl-pds">&gt;</span></span>
#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&lt;</span>iostream<span class="pl-pds">&gt;</span></span>

<span class="pl-k">int</span> <span class="pl-en">main</span>() {
  <span class="pl-k">int</span>* a = <span class="pl-k">new</span> <span class="pl-c1">int</span>(<span class="pl-c1">3</span>);
  std::cout &lt;&lt; *a &lt;&lt; std::endl;
  <span class="pl-k">delete</span> a;
  <span class="pl-k">return</span> <span class="pl-c1">0</span>;
}</pre></div>

<p>Is transformed to:</p>

<div class="highlight highlight-source-c++"><pre>#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&lt;</span>typegrind/log_to_cout.hpp<span class="pl-pds">&gt;</span></span>
#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&lt;</span>iostream<span class="pl-pds">&gt;</span></span>

<span class="pl-k">int</span> <span class="pl-en">main</span>() {
  <span class="pl-k">int</span>* a = <span class="pl-c1">TYPEGRIND_LOG_ALLOC</span>(<span class="pl-s"><span class="pl-pds">"</span>int*<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>example.cpp:6<span class="pl-pds">"</span></span>, <span class="pl-k">new</span> <span class="pl-c1">int</span>(<span class="pl-c1">3</span>), <span class="pl-k">sizeof</span>(<span class="pl-k">int</span>));
  std::cout &lt;&lt; *a &lt;&lt; std::endl;
  <span class="pl-c1">TYPEGRIND_LOG_DEALLOC</span>(a, <span class="pl-s"><span class="pl-pds">"</span>example.cpp:8<span class="pl-pds">"</span></span>, <span class="pl-k">delete</span> a);
  <span class="pl-k">return</span> <span class="pl-c1">0</span>;
}</pre></div>

<p>Which is transformed by a logger, for example by the demo cout logger to:</p>

<div class="highlight highlight-source-c++"><pre>#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&lt;</span>typegrind/log_to_cout.hpp<span class="pl-pds">&gt;</span></span>
#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&lt;</span>iostream<span class="pl-pds">&gt;</span></span>

<span class="pl-k">int</span> <span class="pl-en">main</span>() {
  <span class="pl-k">int</span>* a = <span class="pl-c1">typegrind::log_cout::alloc</span>(<span class="pl-s"><span class="pl-pds">"</span>int*<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>example.cpp:6<span class="pl-pds">"</span></span>, (<span class="pl-k">new</span> <span class="pl-c1">int</span>(<span class="pl-c1">3</span>)), <span class="pl-k">sizeof</span>(<span class="pl-k">int</span>));
  std::cout &lt;&lt; *a &lt;&lt; std::endl;
  <span class="pl-c1">typegrind::log_cout::dealloc</span>(a, <span class="pl-s"><span class="pl-pds">"</span>example.cpp:8<span class="pl-pds">"</span></span>); (<span class="pl-k">delete</span> a);
  <span class="pl-k">return</span> <span class="pl-c1">0</span>;
}</pre></div>

<h2>
<a id="known-limitations" class="anchor" href="#known-limitations" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Known limitations</h2>

<ul>
<li>Exotic macros related to object allocation will cause compilation errors. For example:
<code>cpp
 #define DECL_AN_INT(name) int* name = new int(0);
</code>
</li>
<li>Delete loggers might call the pointer expression twice - once for logging, once for deleting it. It has to be extracted into a variable before use.</li>
<li>Include directives / linker settings aren't modified by typegrind. The projects using it should include the desired logger, and link to it's library if it has one.</li>
<li>Instrumenting system includes is problematic - an overlay should be used for files outside the project scope</li>
</ul>

<h2>
<a id="future-work" class="anchor" href="#future-work" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Future work</h2>

<ul>
<li>Solve the above limitations</li>
<li>Implement the planned macros in the API (see API docs for details - some of them require more research)</li>
<li>Improve the usage process (call clang with an in-memory VFS automatically)</li>
<li>Create production ready standard loggers</li>
<li>Create a user friendly logger frontend</li>
<li>Make it possible to build Typegrind without building clang from sources first</li>
</ul>

<h2>
<a id="documentation" class="anchor" href="#documentation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Documentation</h2>

<p>The documentation can be found under the <code>doc</code> folder in the source, written in markdown, browsable on GitHub.</p>

<h2>
<a id="credits" class="anchor" href="#credits" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Credits</h2>

<p>Typegrind is based on:</p>

<ul>
<li>J. Mihalicza, Z. Porkoláb, and A. Gábor, <a href="http://dx.doi.org/10.1109/ICSM.2011.6080813">Type-preserving heap profiler for C++</a> (2011)</li>
<li>J. Mihalicza, <a href="http://www.tnkcs.inf.elte.hu/vedes/Mihalicza_Jozsef_Ertekezes.pdf">Analysis and Methods for Supporting Generative Metaprogramming in Large Scale C++ Projects</a> (2014)</li>
<li>The type-preserving heap-profiler used by <a href="http://nng.com/en/">NNG Llc.</a>, also based on the above articles</li>
</ul>

<h2>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>License</h2>

<p>Typekit is published under the 
<a href="https://opensource.org/licenses/MIT">MIT License</a></p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
